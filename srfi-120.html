<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>SRFI 120: Timer APIs</title>
  </head>
  <body>

<H1>Title</H1>
Timer APIs
<H1>Author</H1>
Takashi Kato

<H1>Status</H1>

<p>
This SRFI is currently in ``draft'' status.
To see an explanation of
each status that a SRFI can hold, see <a
href="http://srfi.schemers.org/srfi-process.html">here</a>.

To provide input on this SRFI, please
<a href="mailto:srfi minus 120 at srfi dot schemers dot org">mail to
<code>&lt;srfi minus 120 at srfi dot schemers dot org&gt;</code></a>.  See
<a href="../srfi-list-subscribe.html">instructions here</a> to
subscribe to the list.  You can access previous messages via
<a href="mail-archive/maillist.html">the archive of the mailing list</a>.
</p><ul>
    <li>Received: <a
    href="http://srfi.schemers.org/cgi-bin/viewcvs.cgi/*checkout*/srfi/srfi-120/srfi-120.html?rev=1.1">2015/01/27</a></li>
      <li>Draft: 2015/02/03-2015/04/03</li>
</ul>


    <h1> Abstract</h1>
    <p>This SRFI defines interfaces to handle timer processes.</p>
    <h1> Issues</h1>
    <p>There is no issue.</p>
    <h1> Rationale</h1>
    <p>Timer is one of the important features to implement a practical program.
It is trivial to implement if implementations support thread. However not all
Scheme implementations support SRFI-18 nor POSIX thread model. Some of the
implementations even don't expose mutex. So it is nice to have the interface
to handle timer to hide underlying implementation.</p>
    <h1> Specification</h1>
    <p>
      <code>(make-timer [error-handler])</code>
    </p>
    <p>Creates a timer object. The optional argument <em>error-handler</em> must be a
procedure which accepts one argument. If it is given and when a timer
task raises an error, then the handler will be invoked and timer will
continue if the <em>error-handler</em> wouldn't raise an error. Otherwise
whenever an error is raised, timer stops and preserves the error.
The error is raised when <code>timer-stop!</code> procedure is called.</p>
    <p>
      <code>(timer? obj)</code>
    </p>
    <p>Returns <code>#t</code> if given <em>obj</em> is a timer object, otherwise <code>#f</code>.</p>
    <p>
      <code>(timer-start! timer)</code>
    </p>
    <p>Starts the given <em>timer</em>. Timer won't do any task unless it's started.
If one or more tasks are scheduled before the timer is started and
the scheduled time is passed, then timer invokes the tasks.</p>
    <p>
      <code>(timer-stop! timer)</code>
    </p>
    <p>Stops the given <em>timer</em>. The procedure raises the preserved error if there
is. Once a timer is stopped, it will never be able to start again.</p>
    <p>
      <code>(timer-schedule! timer thunk when [period])</code>
    </p>
    <p>Schedules the given <em>thunk</em> as the given <em>timer</em>'s task. The <em>when</em> argument
specifies when the task will be started. It can be either time object or
non negative integer. If the <em>when</em> is a time object, then the task is
scheduled on that time. If the <em>when</em> is an integer, then the task is
scheduled on passed number milliseconds later.</p>
    <p>If the optional argument <em>period</em> is given and if it's a positive number,
then the given task is scheduled as periodical task. The number is interpreted
as milliseconds.</p>
    <p>The executing order of the same timing tasks are not defined.</p>
    <p>The procedure returns timer id which is an integer.</p>
    <p>
      <code>(timer-reschedule! timer id when [period])</code>
    </p>
    <p>Reschedules the task associated to the given <em>id</em> on the given <em>timer</em>.
The <em>when</em> and <em>period</em> arguments are the same as <code>timer-schedule!</code>.</p>
    <p>Thus to cancel the periodical task, you can specify 0 as <em>period</em> argument.</p>
    <p>The procedure returns given <em>id</em>.</p>
    <p>
      <code>(timer-remove! timer id)</code>
    </p>
    <p>Removes the task associated to the given <em>id</em> on the given <em>timer</em>. It
returns <code>#t</code> if a task is removed, otherwise <code>#f</code>.</p>
    <p>
      <code>(timer-exists? timer id)</code>
    </p>
    <p>Returns <code>#t</code> if a task associated to the given <em>id</em> exists, otherwise <code>#f</code>.</p>
    <h1> Implementation</h1>
    <p>The <a href="timer.tar.gz">sample implementation</a> of this SRFI depends on the 
following SRFIs:</p>
    <ul>
      <li>
        <a href="http://srfi.schemers.org/srfi-18/srfi-18.html">SRFI 18 - Multithreading support</a>
      </li>
      <li>
        <a href="http://srfi.schemers.org/srfi-19/srfi-19.html">SRFI 19 - Time Data Types and Procedures</a>
      </li>
      <li>
        <a href="http://srfi.schemers.org/srfi-69/srfi-69.html">SRFI 69 - Basic hash tables</a>
      </li>
      <li>
        <a href="http://srfi.schemers.org/srfi-114/srfi-114.html">SRFI 114 - Comparators</a>
      </li>
    </ul>
    <p>It is written in R7RS library system, the name is <code>(timer)</code>.</p>
    <h1> Copyright</h1>
    <p>Copyright (C) Takashi Kato (2015). All Rights Reserved.</p>
    <p>Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in 
the Software without restriction, including without limitation the rights to 
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies 
of the Software, and to permit persons to whom the Software is furnished to do 
so, subject to the following conditions:</p>
    <p>The above copyright notice and this permission notice shall be included in all 
copies or substantial portions of the Software.</p>
    <p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE 
SOFTWARE.</p>
    <hr>
    <address>Editor: <a href="mailto:srfi-editors at srfi dot schemers dot org">Michael Sperber</a></address>

  </body>
</html>
